'use strict';

var React = require('react');
var ReactDOM = require('react-dom');
var EditorSelection = require('../../utils/EditorSelection');
var EditorDOM = require('../../utils/EditorDOM');
var EditorResize = require('../../utils/EditorResize.react');

var EditorContentEditableDiv = React.createClass({
	displayName: 'EditorContentEditableDiv',

	getInitialState: function getInitialState() {
		return {
			content: ""
		};
	},
	componentDidMount: function componentDidMount(e) {
		window.addEventListener("mousedown", this.handleWindowMouseDown);
	},
	componentWillUnmount: function componentWillUnmount(e) {
		window.removeEventListener("mousedown", this.handleWindowMouseDown);
	},
	componentWillUpdate: function componentWillUpdate(e) {
		// EditorSelection.cloneRange();
	},
	componentDidUpdate: function componentDidUpdate(e) {
		// EditorSelection.cloneRange();
	},
	getContent: function getContent() {
		var target = ReactDOM.findDOMNode(this.refs.edit);
		return target.innerHTML;
	},
	setContent: function setContent(content) {
		this.setState({
			content: content
		});
		var target = ReactDOM.findDOMNode(this.refs.edit);
		target.innerHTML = content;
	},
	getName: function getName() {
		return "div";
	},
	handleWindowMouseDown: function handleWindowMouseDown(e) {
		e = e || event;
		var target = e.target || e.srcElement;
		var tagName = target.tagName.toUpperCase();
		var FormControls = ["TEXTAREA", "INPUT", "SELECT", "OPTIONS"];
		if (FormControls.indexOf(tagName) != -1) {
			console.log("in FormControls");
			return;
		}
		EditorSelection.clearRange();
	},
	handleMouseDown: function handleMouseDown(e) {
		EditorSelection.clearRange();
		window.addEventListener("mouseup", this.handleMouseUp);
		EditorDOM.stopPropagation(e);
	},
	handleMouseUp: function handleMouseUp(e) {
		EditorSelection.createRange();
		window.removeEventListener("mouseup", this.handleMouseUp);

		if (this.props.onRangeChange) this.props.onRangeChange(e);
		EditorDOM.stopPropagation(e);
	},
	setResizeTarget: function setResizeTarget(target) {
		this.refs.resize.setTarget(target);
	},
	clearResizeTarget: function clearResizeTarget() {
		this.refs.resize.clearTarget();
	},
	getEditorRange: function getEditorRange() {
		return ReactDOM.findDOMNode(this.refs.edit);
	},
	render: function render() {
		return React.createElement(
			'div',
			{ className: 'editor-contenteditable-div' },
			React.createElement(EditorResize, { ref: 'resize' }),
			React.createElement('div', { className: 'editable-range', ref: 'edit', onMouseUp: this.handleMouseUp, onMouseDown: this.handleMouseDown,
				contentEditable: true, dangerouslySetInnerHTML: { __html: this.state.content } })
		);
	}
});
module.exports = EditorContentEditableDiv;